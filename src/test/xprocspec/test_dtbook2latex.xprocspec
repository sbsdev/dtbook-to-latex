<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
               xmlns:c="http://www.w3.org/ns/xproc-step"
               xmlns:cx="http://xmlcalabash.com/ns/extensions"
               xmlns:dtb="http://www.daisy.org/z3986/2005/dtbook/">
  
  <x:script>
    <p:pipeline type="x:test" name="main" version="1.0">
      <p:option name="save-as" required="true"/>
      <p:xslt name="xslt">
        <p:input port="stylesheet">
          <p:inline>
            <xsl:stylesheet version="2.0">
              <xsl:import href="../../main/resources/xml/dtbook2latex_sbs.xsl"/>
              <xsl:template match="/">
                <xsl:element name="c:data">
                  <xsl:attribute name="content-type" select="'application/x-latex'"/>
                  <xsl:apply-imports/>
                </xsl:element>
              </xsl:template>
            </xsl:stylesheet>
          </p:inline>
        </p:input>
      </p:xslt>
      <p:store method="text" name="store">
        <p:with-option name="href" select="$save-as"/>
      </p:store>
      <p:identity cx:depends-on="store">
        <p:input port="source">
          <p:pipe step="xslt" port="result"/>
        </p:input>
      </p:identity>
    </p:pipeline>
  </x:script>
  
  <x:scenario label="br_in_bridgehead">
    <x:call step="x:test">
      <x:input port="source">
        <x:document type="file" href="br_in_bridgehead.xml"/>
      </x:input>
      <x:param name="font" select="'Tiresias LPfont'"/>
      <x:param name="fontsize" select="'17pt'"/>
      <x:param name="pageStyle" select="scientific"/>
      <x:param name="alignment" select="'left'"/>
      <x:param name="line_spacing" select="'onehalfspacing'"/>
      <x:param name="replace_em_with_quote" select="'true'"/>
      <x:option name="save-as" select="resolve-uri('br_in_bridgehead.tex',$temp-dir)"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="compare">
      <x:document type="file" href="br_in_bridgehead.tex"/>
    </x:expect>
  </x:scenario>
  
</x:description>
